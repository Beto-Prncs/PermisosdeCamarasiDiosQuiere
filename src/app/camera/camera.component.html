<div class="camera-container">
  <!-- Vista previa de la cÃ¡mara o imagen seleccionada -->
  <div class="main-preview-container">
    <!-- Vista previa de cÃ¡mara en tiempo real -->
    @if (cameraActive) {
      <div class="video-container">
        <video #videoElement class="camera-preview" autoplay playsinline></video>
        <div class="camera-controls">
          <button (click)="switchCamera()" class="switch-camera-button" title="Cambiar cÃ¡mara">
            <span class="camera-icon">ğŸ”„</span>
          </button>
          <button (click)="capturePhoto()" class="capture-button" title="Tomar foto">
            <span class="camera-icon">ğŸ“¸</span>
          </button>
          <button (click)="stopCamera()" class="stop-camera-button" title="Cerrar cÃ¡mara">
            <span class="camera-icon">âœ–</span>
          </button>
        </div>
      </div>
    }
    
    <!-- Imagen seleccionada de la galerÃ­a -->
    @if (!cameraActive && selectedImage) {
      <div class="image-view">
        <img [src]="selectedImage" alt="Imagen seleccionada" class="captured-image">
        <button (click)="selectedImage = null" class="close-image-button">âœ–</button>
      </div>
    }
    
    <!-- Ãšltima foto capturada (solo si no hay imagen seleccionada) -->
    @if (!cameraActive && !selectedImage && imgUrl) {
      <div class="image-view">
        <img [src]="imgUrl" alt="Ãšltima foto capturada" class="captured-image">
      </div>
    }
    
    <!-- Placeholder cuando no hay imagen ni cÃ¡mara activa -->
    @if (!cameraActive && !selectedImage && !imgUrl) {
      <div class="placeholder">
        <span class="placeholder-icon">ğŸ“·</span>
        <span class="placeholder-text">Toca el botÃ³n de cÃ¡mara para comenzar</span>
      </div>
    }
  </div>

  <!-- Botones de acciÃ³n principales -->
  <div class="actions-container">
    @if (!cameraActive) {
      <button (click)="startCamera()" class="start-camera-button" [disabled]="loading">
        <span class="button-icon">ğŸ“·</span>
        <span class="button-text">Iniciar CÃ¡mara</span>
      </button>
    }
    
    <button (click)="loadFromGallery()" class="load-gallery-button" [disabled]="loading">
      <span class="button-icon">ğŸ“</span>
      <span class="button-text">GalerÃ­a</span>
    </button>
    
    @if (imageGallery.length > 0) {
      <button (click)="clearGallery()" class="clear-gallery-button">
        <span class="button-icon">ğŸ—‘ï¸</span>
        <span class="button-text">Limpiar</span>
      </button>
    }
  </div>

  <!-- Spinner de carga -->
  @if (loading) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text">Procesando...</div>
    </div>
  }

  <!-- Mensaje de error -->
  @if (errorMessage) {
    <div class="error-message">
      {{ errorMessage }}
      <button class="close-error-button" (click)="errorMessage = ''">âœ–</button>
    </div>
  }

  <!-- GalerÃ­a de imÃ¡genes -->
  @if (imageGallery.length > 0) {
    <div class="gallery-section">
      <div class="gallery-header">
        <div class="gallery-title">GalerÃ­a ({{ imageGallery.length }})</div>
      </div>
      
      <div class="gallery-container">
        @for (image of imageGallery; track $index; let i = $index) {
          <div class="gallery-item" [class.selected]="selectedImage === image">
            <img [src]="image" alt="Imagen {{ i + 1 }}" (click)="selectImage(image)">
            <button class="delete-image-button" (click)="deleteImage(i)">âœ–</button>
          </div>
        }
      </div>
    </div>
  }
</div>